when:
  - event: [manual, pull_request]
  - event: push
    branch: main

steps:

  backstage:
    image: ghcr.io/grayc-de/plugins/backstage-entity-validator
    depends_on: []
    when: [path: {include: [catalog-info.yaml]}]

  kustomize:
    image: ghcr.io/grayc-de/plugins/kubectl
    depends_on: []
    commands:
      - kubectl kustomize ./fluxcd/live/dev
      - kubectl kustomize ./fluxcd/live/prod
    when: [path: {include: [fluxcd/**]}]

  maven:
    image: ghcr.io/grayc-de/plugins/maven
    depends_on: []
    commands: [mvn validate]
    when: [path: {include: ["**/pom.xml", "**/*.java"]}]

  markdown:
    image: ghcr.io/grayc-de/plugins/markdownlint
    depends_on: []
    when: [path: {include: [.markdownlint.yaml, .markdownlintignore, "**/*.md"]}]

  shell:
    image: ghcr.io/grayc-de/plugins/shellcheck
    depends_on: []
    when: [path: {include: ["**/*.sh"]}]

  yaml:
    image: ghcr.io/grayc-de/plugins/yamllint
    depends_on: []
    when: [path: {include: [.yamllint.yaml, "**/*.yaml"]}]

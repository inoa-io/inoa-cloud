micronaut:
  application:
    name: INOA Cloud
  server:
    port: 8080
  # https://docs.micronaut.io/latest/guide/#clientConfiguration
  http:
    services:
      keycloak:
        url: http://keycloak.${inoa.domain}:8080
        path: /
        follow-redirects: false
        connect-timeout: ${keycloak.connect-timeout:1000ms}
        read-timeout: ${keycloak.read-timeout:2000ms}
      hawkbit:
        url: http://hawkbit.${inoa.domain}:8080/UI/login
  # https://micronaut-projects.github.io/micronaut-security/latest/guide/#securityConfiguration
  security:
    oauth2:
      openid:
        logout-uri: /oauth/logout
      clients:
        inoa-cloud:
          openid:
            issuer: ${micronaut.http.services.keycloak.url}${micronaut.http.services.keycloak.path}realms/inoa
          client-id: inoa-cloud
          client-secret: ${inoa-cloud.client-secret:changeMe}
          grant-type: CLIENT_CREDENTIALS
          client-credentials:
            service-id-regex: inoa-cloud
            # https://micronaut-projects.github.io/micronaut-security/latest/guide/#oauth
        inoa-groundcontrol:
          openid:
            issuer: http://keycloak.${inoa.domain}:8080/realms/inoa
            end-session.enabled: true
          client-id: inoa-groundcontrol
          client-secret: changeMe
          scopes:
            - openid
            - email
            - profile
    # https://micronaut-projects.github.io/micronaut-security/latest/guide/#securityConfiguration
    token:
      name-key: sub
      roles-key: roles
      # https://micronaut-projects.github.io/micronaut-security/latest/guide/#cookieToken
      cookie:
        cookie-http-only: true
        cookie-same-site: lax
        # https://micronaut-projects.github.io/micronaut-security/latest/guide/#jwt
      jwt:
        claims-validators:
          audience: inoa-registry
        signatures:
          jwks:
            keycloak:
              url: ${micronaut.http.services.keycloak.url}${micronaut.http.services.keycloak.path}realms/inoa/protocol/openid-connect/certs
    authentication: idtoken
    redirect:
      unauthorized:
        url: /oauth/login/inoa-groundcontrol
      prior-to-login: true
    # https://micronaut-projects.github.io/micronaut-security/latest/guide/#logoutHandler
    endpoints:
      logout:
        enabled: true
        path: /logout
        get-allowed: true
  router:
    static-resources:
      app:
        mapping: /**
        paths: file:/${static.path}
inoa:
  domain: ${inoa.domain:-foo.io}
  fleet:
    # allow audience test access to all tenants
    security:
      tenant-audience-whitelist: inoa
    # add some default configurations
    tenant:
      configurations:
        - definition:
            key: ntp.host
            description: Host of ntp server to use.
            type: STRING
            pattern: "[a-z0-9\\.]{8,20}"
          value: pool.ntp.org
        - definition:
            key: mqtt.url
            description: URI of mqtt server.
            type: STRING
            pattern: (tcp|mqtt|ssl|mqtts)://[a-z0-9\\.\\-]+:[0-9]{3,5}
          value: tcp://inoa.${inoa.domain}:${inoa.mqtt.port}
        - definition:
            key: mqtt.insecure
            description: Should the client accept unsecure mqtt connections?
            type: BOOLEAN
          value: true
    gateway:
      token:
        audience: inoa-registry
  mqtt:
    port: 1883
    tls:
      port: 8883
      generateKey: false
      key: /tls/key.pem
      cert: /tls/cert.pem
datasources:
  default:
    host: postgres.default
    username: inoa
    database: inoa
    password: changeMe

influxdb:
  url: http://influxdb.default:8086
  organisation: inoa
  bucket: default
kafka:
  bootstrap:
    servers: kafka.default:9092

pageable:
  maxPageSize: 30
